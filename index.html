<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海纜斷掉時網站會動嗎？</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .result-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .score {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 8px;
        }
        .score-O { background-color: #d4edda; color: #155724; }
        .score-Q { background-color: #fff3cd; color: #856404; }
        .score-X { background-color: #f8d7da; color: #721c24; }
        .domain-details {
            margin-top: 10px;
            padding-left: 20px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        code {
            font-family: Monaco, Consolas, "Courier New", monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>海纜斷掉時網站會動嗎？</h1>
    <div id="results"></div>

    <script>
        const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/irvin/digital-service-resilience-test-result/refs/heads/main/';

        async function fetchTestResult(filename) {
            try {
                const response = await fetch(GITHUB_RAW_URL + filename);
                return await response.json();
            } catch (error) {
                console.error('Error fetching result:', error);
                return null;
            }
        }

        function formatDate(isoString) {
            return new Date(isoString).toLocaleString('zh-TW');
        }

        function createResultCard(result) {
            return `
                <div class="result-card">
                    <h2>
                        <a href="${result.url}" target="_blank">${result.url}</a>
                    </h2>
                    <p>最後一次測試時間: ${formatDate(result.timestamp)}</p>
                    <p>測試結果:</p>
                    <div>
                        <span class="score score-O">境內連線 (O): ${result.test_results.domestic}</span>
                        <span class="score score-Q">具有國內節點的雲端 (?): ${result.test_results.cloud_w_domestic_node}</span>
                        <span class="score score-X">境外連線 (X): ${result.test_results.foreign}</span>
                    </div>
                    <div class="domain-details">
                        <pre><code>${JSON.stringify(result.domainDetails, null, 2)}</code></pre>
                    </div>
                </div>
            `;
        }

        // 從 URL 參數取得要顯示的網址
        function getUrlParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get('url');
        }

        // 將網址轉換為對應的 JSON 檔名
        function urlToFilename(url) {
            // 移除 protocol
            url = url.replace(/^https?:\/\//, '');
            return `${url}.json`;
        }

        async function loadResults() {
            const resultsDiv = document.getElementById('results');
            const urlParam = getUrlParam();

            if (!urlParam) {
                resultsDiv.innerHTML = `
                    <p>請在網址後加上 ?url= 參數來查看特定網站的測試結果</p>
                    <p>例如：<code>?url=g0v.tw</code></p>
                `;
                return;
            }

            // 顯示指定網址的結果
            const filename = urlToFilename(urlParam);
            const result = await fetchTestResult(filename);
            if (result) {
                resultsDiv.innerHTML = createResultCard(result);
            } else {
                resultsDiv.innerHTML = `<p>找不到 ${urlParam} 的測試結果</p>`;
            }
        }

        // 載入測試結果
        loadResults();
    </script>
</body>
</html> 